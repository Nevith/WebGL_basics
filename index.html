<!DOCTYPE html>

<html>
    <head>
        <title>WebGL basics</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Jquery, Bootstrap and FontAwesome -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
              integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
              crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
                integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
                crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
                integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
                crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <!-- WebGL libs -->
        <script src="js/libs/gl-matrix/gl-matrix.js"></script>
        <!-- Parse .obj files -->


        <!-- FONT -->
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Ubuntu" />

        <!-- Our code -->
        <script src="js/glDrawable.js"></script>
        <script src="js/uiController.js"></script>
        <script src="js/glController.js"></script>
        <link rel="stylesheet" href="css/style.css">

        <!-- Shaders -->
        <script id="vertex-shader" type="x-shader/x-vertex">

            #version 100
            
            precision mediump float;

            uniform vec3 LIGHT;
            uniform mat4 PVM;
            uniform mat4 M_INVERSE_TRANSPOSE;
            uniform mat4 M;

            uniform float KA;   // Ambient reflection coefficient
            uniform float KD;   // Diffuse reflection coefficient
            uniform float KS;   // Specular reflection coefficient

            uniform vec3 ambient_color;
            uniform vec3 diffuse_color;
            uniform vec3 specular_color;

            attribute vec3 vertex;
            attribute vec3 normal;
            attribute vec2 uv;

            varying vec2 texture_coordinates;
            varying vec3 light_weighting;

            void main(){
                gl_Position= PVM * vec4(vertex,1);

                // Pass on texture coordinates
                texture_coordinates = uv;

                // Compute normal
                vec3 normal_v = normalize(mat3(M_INVERSE_TRANSPOSE) * normal);

                // Compute the world position of the surface
                vec3 surface_world_position = (M * vec4(vertex,1)).xyz;

                // Compute the vector of the surface to the light
                vec3 surface_to_light = normalize(LIGHT - surface_world_position);

                // Calculate N dot L for diffuse lighting
                float diffuse_light_weighting = max(dot(normal_v, surface_to_light), 0.0);
                diffuse_light_weighting = diffuse_light_weighting * KD;

                // Calculate the reflection vector (R) that is needed for specular light
                vec3 reflection_vector = normalize(reflect(-surface_to_light, normal_v));

                vec3 view_vector = -normalize(gl_Position.xyz);
                float rdotv = max(dot(reflection_vector, view_vector), 0.0);
                float specular_light_weighting = pow(rdotv, KS);

                light_weighting = ambient_color * KA +
                                 diffuse_color * diffuse_light_weighting +
                                 specular_color * specular_light_weighting;
            }

        </script>
        <script id="fragment-shader" type="x-shader/x-fragment">
            #version 100

            precision mediump float;

            uniform sampler2D sampler;

            varying vec2 texture_coordinates;
            varying vec3 light_weighting;

            void main(){
                vec4 texture = texture2D(sampler, texture_coordinates);

                // modulate texture color with light_weigthing and write as final color
                gl_FragColor = vec4(light_weighting.rgb * texture.rgb, texture.a);
            }
        </script>
    </head>

    <body>
        <div id="app" class="container">
            <div class="row">
                <canvas id="gl_canvas" class="col">
                    Your web browser does not support Canvas.
                </canvas>
            </div>
            <div id="base_instructions" class="row">
                <div id="camera_instructions" class="col">
                    <h3>Camera</h3>
                    <p>
                        <b>Move:</b> W A S D + Q and E<br>
                        <b>Rotate:</b> I J K L + U and O<br>
                        <b>Perspective change:</b> Space<br>
                    </p>
                </div>
                <div class="col form-group">
                    <h3> Light coordinates </h3>
                    <label for="x_pos">X: </label>
                    <input class="form-control-static" id="x_pos" type=number step=0.01 onchange="captureLightChange()"/>
                    <br>
                    <label for="y_pos">Y: </label>
                    <input class="form-control-static" id="y_pos" type=number step=0.01 onchange="captureLightChange()"/>
                    <br>
                    <label for="z_pos">Z: </label>
                    <input class="form-control-static" id="z_pos" type=number step=0.01 onchange="captureLightChange()"/>
                </div>
                <div id="button_box" class="col">
                    <button class="btn btn-primary" style="margin: 5px; float: right"
                            onclick="selectObj()">
                        <span class="fa fa-plus"></span>
                    </button>
                </div>
            </div>
        </div>
        <div id="object_container" class="container">
        </div>
    </body>
</html>
